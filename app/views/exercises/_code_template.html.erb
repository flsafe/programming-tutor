<% new_or_existing = code_template.new_record? ? 'new' : 'existing' %>
<% prefix = "exercise[#{new_or_existing}_template_attributes][]" %>

<div class="code_template">
<% fields_for prefix, code_template do |f|%>
	<% if code_template.src_code.blank? then %>
		<%= f.label :template_file, "Upload Template" %><br/>
		<%= f.file_field :template_file%><%= link_to_function 'Remove Template', "this.up('.code_template').remove()" %>
	<% else %>
		<%= f.label :src_language %> <%= link_to_function 'Remove Template', "this.up('.code_template').remove()" %><br/>
		<%= f.text_field :src_language%><br/>
	
		<%= f.label :src_code %><br/>
		<%= f.text_area :src_code %><br/>
	<% end %>
<% end %>
</div>